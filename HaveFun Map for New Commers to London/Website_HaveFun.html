<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Have Fun</title>

    <!--MapBox 1.13.0 for Carto-->
    <script src="https://libs.cartocdn.com/mapbox-gl/v1.13.0/mapbox-gl.js"></script>
    <link href="https://libs.cartocdn.com/mapbox-gl/v1.13.0/mapbox-gl.css" rel="stylesheet" />
    
    <!-- Mapbox Library -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet">

    <!--MapLibre-->
    <script src="https://cdn.maptiler.com/maplibre-gl-js/v1.13.0-rc.4/mapbox-gl.js"></script>
    <link href="https://cdn.maptiler.com/maplibre-gl-js/v1.13.0-rc.4/mapbox-gl.css" rel="stylesheet" />

    <!-- DeckGL Library -->
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>

    <!-- DeckGL Carto Library -->
    <script src="https://unpkg.com/@deck.gl/carto@latest/dist.min.js"></script>

    <!-- D3.js -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-scale@4"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-scale/1.0.7/d3-scale.min.js" integrity="sha512-CagQ2MAkdTRJK0ge/Q/+y2QL+0wvabHP7y7GIKwy7E5aptPLpHu26CDi3Ec95xkYPMvZBqjNOwe02NZoBqWXIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!--Jquery-->
    <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>

    <!--ECharts-->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.1.2/dist/echarts.min.js"></script>

  

    <style type="text/css">
        body {
            margin: 0px;
            padding: 0px;
        }

        #container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            font-family: Arial;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .tooltip {
            position: absolute;
            visibility: hidden;
            z-index: 2;
            right: 0;
            top: 30;
            width: 20%;
            height: auto;
            min-height: 100px;

            display: grid;
            grid-template-columns: auto auto;
            grid-template-rows: auto;
            grid-template-areas:
                "title title"
                "item-a item-a"
                "item-b item-b"
                "item-c item-c";

            background-color: rgb(0, 0, 0);
            opacity: 0.75;
            color: white;
            border: 1.5px solid #888;
            }

        .title {
            /* border: 1px solid red; */
            grid-area: title;
            font-weight: bold;
            font-size: 14px;
            margin: 2px;
            /* margin-top: 2px;
            margin-bottom: 2px;
            margin-right: 4px;
            margin-left: 4px;  */
        }

        .item-a {
            /* border: 1px solid yellow; */
            grid-area: item-a;
            font-size: 14px;
            margin: 2px;
        }

        .item-b {
            /* border: 1px solid yellow; */
            grid-area: item-b;
            font-size: 14px;
            margin: 2px;
        }

        .item-c {
            /* border: 1px solid yellow; */
            grid-area: item-c;
            font-size: 14px;
            margin: 2px;
        }

        #filter {
            background-color: rgb(255, 255, 255);
            border-radius: 5px;
            z-index: 1;
            position: absolute;
            width: 300px;
            height: 170px;
            left: 20px;
            top: 40px;
            box-shadow:
            0 0 3px 3px rgb(255, 255, 255,0.3),  /* inner white */
            0 0 5px 5px rgb(255, 255, 255,0.1); /* middle magenta */
            padding: 10px;
        }

        #filter_title {
            /* border: 1px solid black; */
            font-size: 20px;
            font-weight: 900;
            margin-top: 15px;
            margin-bottom: 22px;
            z-index: 1;
        }

        .filterchoice{
            margin-top: 8px;
            font-size: 14px;
            font-weight: 500;
            /* border: 1px solid black; */
        }


        .instruction{
            /* border: 1px solid red; */
            position: absolute;
            z-index: 1;
            left: 20px;
            top: 240px; /*560*/
            width: 300px;
            height: auto;
            border-radius: 5px;
            background-color: rgb(255, 255, 255);
            opacity: 0.7;
            box-shadow:
            0 0 3px 3px rgb(255, 255, 255,0.3),  /* inner white */
            0 0 5px 5px rgb(255, 255, 255,0.1); /* middle magenta */
            padding: 10px;

        }

        #instruction_title {
            /* border: 1px solid black; */
            font-size: 18px;
            font-weight: 900;
            color:rgb(0, 0, 0, 0.7);
            margin-top: 15px;
            margin-bottom: 22px;
            z-index: 1;
        }

        #instruction_content {
            /* border: 1px solid black; */
            font-size: 13px;
            font-weight: 500;
            color:rgb(0, 0, 0, 0.7);
            z-index: 1;
        }

        #text {
            font-size: 22px;
            /* background-color: white; */
            font-weight: 700;
            color:rgb(255, 255, 255);
            opacity: 0.7;
            position: absolute;
            top: 140px;
            left: 570px;
            z-index: 2;
        }

        .dashboard {
            background-color: rgb(255, 255, 255);
            border-radius: 5px;
            z-index: 1;
            position: absolute;
            width: 300px;
            height: auto;
            right: 20px;
            top: 40px;
            box-shadow:
            0 0 3px 3px rgb(255, 255, 255,0.3),  /* inner white */
            0 0 5px 5px rgb(255, 255, 255,0.1); /* middle magenta */
            padding: 10px;
        }


        #dashboard_title {
            font-size: 20px;
            font-weight: 900;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        #content{
            line-height: 30px;
            font-size: 12px;
        }

        .echart{
            /* border: 1px solid black; */
            /* border-radius: 2px; */
            /* padding-top: 100px;
            padding-bottom: 100px; */
            height: 270px
        }

        #number {
            width: 100%;
            /* border: 1px solid black; */
            border-radius: 2px;
            padding-top: 5px;
            padding-bottom: 5px;
            margin-top: 20px;
            display: inline-block
        }

        #number_1, #number_2 {
            /* border: 0.2px solid black; */
            width: 48%;
            height: 90px;
            display: inline-block;
        }

        #number_1 {
            padding-right: 5px;
        }

        #description {
            /* border: 1px solid black; */
            width: 100%;
            height: 20%;
            display: inline-block;
            font-size: 10px;
            font-weight: 700;
            color:rgb(0, 0, 0, 0.7);
            line-height: 10px;
            /* text-align: center; */
        }

        #num {
            /* border: 1px solid red; */
            width: 100%;
            height: 50px;
            display: inline-block;
            font-size: 25px;
            font-weight: 900;
            color:rgb(0, 0, 0,0.9);
            line-height: 50px;
            text-align: center;
            /* transform: translateY(-50%); */
        }

        #suggestion{
            /* border: 1px solid black; */
            /* border-radius: 2px; */
            /* padding-top: 100px;
            padding-bottom: 100px; */
            height: 270px;
            font-size: 18px;
            font-weight: 900;
            margin-top: 25px;
            
        }

        #suggest_attraction{
            /* border: 1px solid red; */
            font-size: 12px;
            font-weight: 500;
            margin-top: 20px;
            padding: 10px;
            background-color: rgb(0, 0, 0, 0.1);
            border-radius: 2px;        
        }

        #suggest_text{
            /* border: 1px solid black; */
            font-size: 14px;
            font-weight: 700;
            padding-left: 10px;
            line-height: 12px;
        }


    </style>

</head>

<body>
    <div id="container">
        <div id="map">
            <div id="filter">
                <div id="filter_title">Layer</div>
                <div class="filterchoice">
                    <input type="radio" name="fillterradio" id="Overseasradio" checked="checked" onclick = "toggleLayer();">
                    <label for="Overseasradio">
                        Overseas Staying Visitor Map
                    </label>
                </div>
                <div class="filterchoice">
                    <input type="radio" name="fillterradio" id="Domesticradio"  onclick = "toggleLayer();">
                    <label for="Domesticradio">
                        Domestic Staying Visitor Map
                    </label>
                </div>
                <div class="filterchoice">
                    <input type="radio" name="fillterradio"  id="Attractionradio" onclick="toggleLayer();">
                    <label for="Attractionradio">
                        Attractions in London
                    </label>
                </div>
                <div class="filterchoice">
                    <input type="radio" name="fillterradio"  id="Internationalradio" onclick="toggleLayer();">
                    <label for="Attractionradio">
                        The Origins of International Visitor
                    </label>
                </div>
            </div>
            
            <div id='instruction_Overseas' class="instruction instruction_for_Overseas" style="display: block;">
                <div id='instruction_title'>Instruction</div>
                <p id='instruction_content'>- Hover over the columns to explore the number of overseas visitors to each borough in London.</p>
                <p id='instruction_content'>- The higher and darker the column is, the larger volume of visitors the borough has per day.</p>
            </div>
            <div id='instruction_Domestic' class="instruction instruction_for_Domestic" style="display: none;">
                <div id='instruction_title'>Instruction</div>
                <p id='instruction_content'>- Hover over the columns to explore the number of domestic visitors to each borough in London.</p>
                <p id='instruction_content'>- The higher and darker the column is, the larger volume of visitors the borough has per day.</p>
            </div>
            <div id='instruction_Attraction' class="instruction instruction_for_Attraction" style="display: none;">
                <div id='instruction_title'>Instruction</div>
                <p id='instruction_content'>- Try to zoom in/out and drag the map.</p>
                <p id='instruction_content'>- Hover over the dots to explore various kinds of attractions in London.</p>
                <p id='instruction_content'>- The colors represent different kinds of attractions.</p>
                <img src="./img/legend_Attraction.png" alt="legend for attraction" width="180" height="auto"> 
            </div>
            <div id='instruction_International' class="instruction instruction_for_International" style="display: none;">
                <div id='instruction_title'>Instruction</div>
                <p id='instruction_content'>- Try to zoom in/out and drag the map.</p>
                <p id='instruction_content'>- Hover over the arcs to explore the origins of international visitors to London.</p>
                <p id='instruction_content'>- The sizes of the circles represent the number of the visitors to London in 2020.</p>
            </div>

            <div id="text" class="text">London</div>
            <div id="tooltip_Overseas" class="tooltip tooltip_for_Overseas"></div>
            <div id="tooltip_Domestic" class="tooltip tooltip_for_Domestic" style="display:none"></div>
            <div id="tooltip_Attraction" class="tooltip tooltip_for_Attraction" style="display:none"></div>
            <div id="tooltip_International" class="tooltip tooltip_for_International" style="display:none"></div>
            <div id="dashboard_Overseas" class="dashboard dashboard_for_Overseas forhide" style="display:block;">
                <div id="dashboard_title">Overseas Staying Visitors</div>
                <div id="content">(in the daytime during an average day)</div>
                <a id="source" href="https://data.london.gov.uk/dataset/daytime-population-borough", target="_blank">Data Source: data.london.gov.uk</a>
                <div id="echart_Overseas" class="echart"></div>
                <div id="number">
                    <div id="number_1">
                        <div id="description">Overseas Staying Visitor in London (per daytime)</div>
                        <div id="num">296,209</div>
                    </div>
                    <div id="number_2">
                        <div id="description">Domestic Staying Visitor in London (per daytime)</div>
                        <div id="num">66,684</div>
                    </div>
                </div>
            </div>
            <div id="dashboard_Domestic" class="dashboard dashboard_for_Domestic forhide" style="display:none;">
                <div id="dashboard_title">Domestic Staying Visitors</div>
                <div id="content">(in the daytime during an average day)</div>
                <a id="source" href="https://data.london.gov.uk/dataset/daytime-population-borough", target="_blank">Data Source: data.london.gov.uk</a>
                <div id="echart_Domestic" class="echart"></div>
                <div id="number">
                    <div id="number_1">
                        <div id="description">Overseas Staying Visitor in London (per daytime)</div>
                        <div id="num">296,209</div>
                    </div>
                    <div id="number_2">
                        <div id="description">Domestic Staying Visitor in London (per daytime)</div>
                        <div id="num">66,684</div>
                    </div>
                </div>
            </div>
            <div id="dashboard_Attraction" class="dashboard dashboard_for_Attraction forhide" style="display:none;">
                <div id="dashboard_title">Attractions in London</div>
                <a id="source" href="https://data.london.gov.uk/dataset/daytime-population-borough", target="_blank">Data Source: data.london.gov.uk</a>
                <div id="suggestion">You may also be interested in...
                    <div id="suggest_attraction">[Based on the kind of attraction hovered]</div>
                </div>
            </div>
            <div id="dashboard_International" class="dashboard dashboard_for_International for hide" style="display:none;">
                <div id="dashboard_title">Origins of International Visitors</div>
                <a id="source" href="https://data.london.gov.uk/dataset/number-international-visitors-london", target="_blank">Data Source: data.london.gov.uk</a>
                <div id="echart_International" class="echart echart_for_International forhide"></div>
                <div id="number">
                    <div id="number_1">
                        <div id="description"># of International Visitors in London in 2020p (unit: 000s)</div>
                        <div id="num">2,555</div>
                    </div>
                    <div id="number_2">
                        <div id="description"># of International Visitors in London in 2019 (unit: 000s)</div>
                        <div id="num">15,079</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>


//////////////////////////
//                      //
// BASESMAP & DATASET   //
//                      //
//////////////////////////
    

    // Setup Carto Credentials
    deck.carto.setDefaultCredentials({
      username: "public",
      apiKey: "default_public",
    });

    // Load in Original Dataset
    const Daytime_Population = './geojson/daytime-population-borough_join_carto_4.geojson';
    const AttractionData = './attraction_3.json';
    const InternationalVisitorData = './international-visitors-london_v3_visit.json';


    // Set up Hovering
    let isHovering = false;



//////////////////////////
//                      //
// VIEW STATE           //
//                      //
//////////////////////////

    // Set Initial view state
    const INITIAL_VIEW_STATE = {
        longitude: -0.09,
        latitude: 51.515477,
        zoom: 9,
        bearing: 0,
        pitch: 45
    };

    // Setup View State: Overseas
    function newViewState_Overseas() {
        deckgl.setProps(
            {
            initialViewState: {
            longitude: -0.09,
            latitude: 51.515477,
            zoom: 9,
            bearing: 0,
            pitch: 45,
            transitionDuration: 2000,
            }},
        )
    };

    // Setup View State: Domestic
    function newViewState_Domestic() {
        deckgl.setProps({
            initialViewState: {
            longitude: -0.09,
            latitude: 51.515477,
            zoom: 9,
            bearing: 0,
            pitch: 45,
            transitionDuration: 2000,
            }
        })
    };

    // Setup View State: Attractioin
    function newViewState_Attraction() {
        deckgl.setProps({
            initialViewState: {
            longitude: -0.12,
            latitude: 51.525477,
            zoom: 10,
            bearing: 0,
            pitch: 0,
            transitionDuration: 1500,
            }
        })
    };


    // Setup View State: International
    function newViewState_International() {
        deckgl.setProps({
            initialViewState: {
            longitude: 0.92,
            latitude: 54.525477,
            zoom: 2,
            bearing: 0,
            pitch: 40,
            transitionDuration: 4500,
            }
        });
    };


//////////////////////////
//                      //
// CONTROLLER           //
//                      //
//////////////////////////


function newController_Overseas() {
        deckgl.setProps({
            controller: {
                dragPan: false,
                touchZoom: false,
                scrollZoom: false,
            }
        })
};

function newController_Domestic() {
        deckgl.setProps({
            controller: {
                dragPan: false,
                touchZoom: false,
                scrollZoom: false,
            }
        })
};


function newController_Attraction() {
        deckgl.setProps({
            controller: {
                dragPan: true,
            }
        })
};

function newController_International() {
        deckgl.setProps({
            controller: {
                dragPan: true,
            }
        })
};






//////////////////////////
//                      //
// COLOR SCHEME         //
//                      //
//////////////////////////

    // Set Color Scheme: Overseas
    function get_colour_Overseas(d) {
        if(d < 4000 ) {
            return [230,249,250]
        // } else if (d < 5000) {
        //     return [193,229,229]
        } else if (d < 7000) {
            return [157,208,212]
        } else if (d < 8000) {
            return [117,187,193]
        } else if (d < 31000) {
            return [75,167,174]
        } else {
            return [0,147,156]
        }
    }

    // Set Color Scheme: Domestic
    function get_colour_Domestic(d) {
        if(d < 900 ) {
            return [230,249,250]
        // } else if (d < 5000) {
        //     return [193,229,229]
        } else if (d < 1200) {
            return [157,208,212]
        } else if (d < 1900) {
            return [117,187,193]
        } else if (d < 3000) {
            return [75,167,174]
        } else {
            return [0,147,156]
        }
    }


    // Set Color Scheme: Attraction
    function get_colour_Attraction (d) {
        if( d === 'religion' ) {
            return [250,227,0]
        } else if ( d === 'historic_architecture') {
            return [249,194,2]
        } else if ( d === 'industrial_facilities') {
            return [252,120,1]
        } else if ( d === 'cultural') {
            return [226,26,26]
        } else if ( d === 'historic') {
            return [207,24,80]
        } else if ( d === 'biographical_museums') {
            return [173,15,127]
        } else if ( d === 'museums') {
            return [122,13,166]
        } else if ( d === 'gardens_and_parks') {
            return [72,43,189]
        } else {
            return [44,81,189]
        }
    }



//////////////////////////
//                      //
// DECK.GL INITIAL MAP  //
//                      //
//////////////////////////

    const deckgl = new deck.DeckGL({
        container: "map",
        mapStyle: deck.carto.BASEMAP.DARK_MATTER_NOLABELS,
        initialViewState: {
            latitude:INITIAL_VIEW_STATE.latitude,
            longitude: INITIAL_VIEW_STATE.longitude,
            zoom: INITIAL_VIEW_STATE.zoom,
            bearing: INITIAL_VIEW_STATE.bearing,
            pitch: INITIAL_VIEW_STATE.pitch,
        },
        

        layers:[
        new deck.GeoJsonLayer({
            id: 'DaytimePopu',
            data: Daytime_Population,
            visible: true,
            // Styles
            filled: true,
            stroked: true,
            extruded: true,
            getFillColor: (f) => get_colour_Overseas(f.properties._Overseas_Staying_visitors),
            opacity: 0.9,
            getElevation: (f) => Math.sqrt(f.properties._Overseas_Staying_visitors) * 50,
            getLineColor: (f) => [255, 255, 255],
            
            // Interactive props
            // While it is still possible to use getTooltip function, the onClick and onHover functions provides more customisations for the deck.MapboxLayer
            pickable: true,
            autoHighlight: true,
            highlightColor: [85, 167, 208, 180],
            // highlightColor: [250, 200, 88, 150],

            // Add onHover interaction
            onHover: ({ object }, info) => {
            (isHovering = Boolean(object));
            if (isHovering == true) {
                // console.log("onHover Function works!!");
                showTooltip_Overseas(info, object);
                }
                else { hideTooltip_Overseas(); }
            },

        }),


        new deck.TextLayer({
                id: 'text-layer',
                data: Daytime_Population,
                getPosition: f => f.geometry.coordinates,
                // getText: f => { return f.properties.name.toString(); },
                getText: "hellow",
                getSize: 220,
                getColor: [0, 0, 0, 180],
                getAngle: 0,
                getTextAnchor: 'middle',
                getAlignmentBaseline: 'center',
                fontFamily: 'Gill Sans',
                getbackgroundColor: [255, 255, 255,180],
            }),
        

        ],

        controller: {
            dragPan: false,
            touchZoom: false,
            scrollZoom: false,
        },

    });


    
    
//////////////////////////
//                      //
// TOOLTIP              //
//                      //
//////////////////////////
    
    // Layer: Overseas Visitor
    function hideTooltip_Overseas() {
    d3.select("#tooltip_Overseas").style("visibility", "hidden");
    };

    function showTooltip_Overseas(info, object) {
    d3
        .select("#tooltip_Overseas")
        .style("top", (info.center.y + 3) + "px")
        .style("left", (info.center.x) + "px")
        .style("visibility", "visible")
        .style("pointer-events", "none")
        .html(`<p class='title'> ${object.properties.name}</p>
                <p class='item-a'> Overseas Staying Visitors: ${object.properties._Overseas_Staying_visitors}</p>
                <p class='item-b'> Domestic Staying Visitors: ${object.properties._Domestic_Staying_Visitors}</p>`);
    };

    // Layer: Domestic Visitor
    function hideTooltip_Domestic() {
    d3.select("#tooltip_Domestic").style("visibility", "hidden");
    };

    function showTooltip_Domestic(info, object) {
    d3
        .select("#tooltip_Domestic")
        .style("top", (info.center.y + 3) + "px")
        .style("left", (info.center.x) + "px")
        .style("visibility", "visible")
        .style("pointer-events", "none")
        .html(`<p class='title'> ${object.properties.name}</p>
                <p class='item-a'> Overseas Staying Visitors: ${object.properties._Overseas_Staying_visitors}</p>
                <p class='item-b'> Domestic Staying Visitors: ${object.properties._Domestic_Staying_Visitors}</p>`);
    };



    // Layer: Attractions in London
    function hideTooltip() {
    d3.select("#tooltip_Attraction").style("visibility", "hidden");
    };

    function showTooltip(info, object) {
    d3
        .select("#tooltip_Attraction")
        .style("top", (info.center.y + 3) + "px")
        .style("left", (info.center.x) + "px")
        .style("visibility", "visible")
        .style("pointer-events", "none")
        .html(`<p class='title'> ${object.properties_name}</p>
                <p class='item-a'> Name: ${object.properties_name}</p>
                <p class='item-b'> Kindsss: ${object.properties_kinds_1}</p>`);

    };


    // Layer: International Visitors to London
    function hideTooltip_International() {
    d3.select("#tooltip_International").style("visibility", "hidden");
    };

    function showTooltip_International(info, object) {
    d3
        .select("#tooltip_International")
        .style("top", (info.center.y + 3) + "px")
        .style("left", (info.center.x) + "px")
        .style("visibility", "visible")
        .style("pointer-events", "none")
        .html(`<p class='title'># of International Visitors to London</p>
                <p class='item-a'> Origin: ${object.Country_of_origin}</p>
                <p class='item-b'> To: ${object.To_Place}</p>
                <p class='item-c'> Year: 2020 Projected</p>
                <p class='item-d'> Number (unit: 000s): ${object.LastYear}</p>`);

    };



//////////////////////////
//                      //
// ECHART               //
//                      //
//////////////////////////

////////////////////////////////////////////////////Overseas Visitors////////////////////////////////////////////////////


function setup_Overseas_dashboard() {
    
    // Setup EChart
    var dataArr = [];

    $.get('https://raw.githubusercontent.com/VivianKuKu/CASA0017_Web-Architecture_workshops/main/test.json', {}, 
        function(response) {
            dataArr = JSON.parse(response);
            console.log(dataArr);
            initEchart();
    });


    //initialise ECharts in the Div id=echart
    var myChartEchart = echarts.init(document.getElementById('echart_Overseas'), {
        width: 300, //1000
        height: 300, // 650
        }); //height is used to avoid cut the text on the Xaxis


    function initEchart() {

        // All the settings of the chart are provided in this variable
        var option = {

            tooltip: {
                trigger: 'item'
            },

            series: [ //How the dataset is represented
            {
                type: 'pie',
                name: "",
                radius: ['40%', '70%'], // the radius of two rings
                avoidLabelOverlap: false,
                label: {
                    show: false,
                    position: 'center'
                },
                emphasis: {
                    label: {
                    show: true,
                    fontSize: '20',
                    fontWeight: 'bold'
                    }
                },
                labelLine: {
                    show: true
                },
                data: dataArr.map(row => ({value:row['properties']['_Overseas_Staying_visitors'],name:row['properties']['name']})),
            }],
        }

        // All the above is applied to the chart
        myChartEchart.setOption(option);

    };
}

setup_Overseas_dashboard();

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////Domestic Visitors////////////////////////////////////////////////////

function setup_Domestic_dashboard() {


    // Setup EChart
    var dataArr = [];

    $.get('https://raw.githubusercontent.com/VivianKuKu/CASA0017_Web-Architecture_workshops/main/test.json', {}, 
        function(response) {
            dataArr = JSON.parse(response);
            console.log(dataArr);
            initEchart();
    });


    //initialise ECharts in the Div id=echart
    var myChartEchart = echarts.init(document.getElementById('echart_Domestic'), {
        width: 300, //1000
        height: 300, // 650
        }); //height is used to avoid cut the text on the Xaxis


    function initEchart() {

        // All the settings of the chart are provided in this variable
        var option = {

            tooltip: {
                trigger: 'item'
            },

            series: [ //How the dataset is represented
            {
                type: 'pie',
                name: "",
                radius: ['40%', '70%'], // the radius of two rings
                avoidLabelOverlap: false,
                label: {
                    show: false,
                    position: 'center'
                },
                emphasis: {
                    label: {
                    show: true,
                    fontSize: '20',
                    fontWeight: 'bold'
                    }
                },
                labelLine: {
                    show: true
                },
                data: dataArr.map(row => ({value:row['properties']['_Domestic_Staying_Visitors'],name:row['properties']['name']})),
            }],
        }

        // All the above is applied to the chart
        myChartEchart.setOption(option);

    };

}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////International Visitors to London////////////////////////////////////////////////////

function setup_International_dashboard() {

    var dataArr = [];

    $.get('https://raw.githubusercontent.com/VivianKuKu/CASA0017_Web-Architecture_workshops/main/Group%20Work_VisLondon/international-visitors-london_v3_visit.json', {}, 
        function(response) {
            dataArr = JSON.parse(response);
            console.log(dataArr);
            initEchart();
    });


    //initialise ECharts in the Div id=echart
    var myChartEchart = echarts.init(document.getElementById('echart_International'), {
        width: 300, //1000
        height: 300, // 650
        }); //height is used to avoid cut the text on the Xaxis


    function initEchart() {

        // All the settings of the chart are provided in this variable
        var option = {

            tooltip: {
                trigger: 'item'
            },

            series: [ //How the dataset is represented
            {
                type: 'pie',
                name: "",
                radius: ['40%', '70%'], // the radius of two rings
                avoidLabelOverlap: false,
                label: {
                    show: false,
                    position: 'center'
                },
                emphasis: {
                    label: {
                    show: true,
                    fontSize: '20',
                    fontWeight: 'bold'
                    }
                },
                labelLine: {
                    show: true
                },
                data: dataArr.map(row => ({value:row['LastYear'],name:row['Country_of_origin']})),
            }],
        }

        // All the above is applied to the chart
        myChartEchart.setOption(option);

    };
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


//////////////////////////
//                      //
// CHANGE LAYER         //
//                      //
//////////////////////////


// Toggle Layer Setup
var layerVisibility = {};
// var dashboardVisibility = {};

function toggleLayer() {
    // var layerVisibility = {Overseas:true, Domestic:false, Attraction:false};

    if(document.getElementById("Overseasradio").checked) {
        layerVisibility = {Overseas:true, Domestic:false, Attraction:false, International:false};
        $(".dashboard_for_Overseas").show();
        $(".dashboard_for_Domestic").hide();
        $(".dashboard_for_Attraction").hide();
        $(".dashboard_for_International").hide();
        
        $(".tooltip_for_Overseas").show();
        $(".tooltip_for_Domestic").hide();
        $(".tooltip_for_Attraction").hide();
        $(".tooltip_for_International").hide();

        $(".instruction_for_Overseas").show();
        $(".instruction_for_Domestic").hide();
        $(".instruction_for_Attraction").hide();
        $(".instruction_for_International").hide();

        $(".text").show();

        setup_Overseas_dashboard();
        newViewState_Overseas();
        newController_Overseas();
        console.log(layerVisibility);
    }
        
    else if(document.getElementById("Domesticradio").checked) {
        layerVisibility = {Overseas:false, Domestic:true, Attraction:false, International:false};
        $(".dashboard_for_Overseas").hide();
        $(".dashboard_for_Domestic").show();
        $(".dashboard_for_Attraction").hide();
        $(".dashboard_for_International").hide();
        

        $(".tooltip_for_Overseas").hide();
        $(".tooltip_for_Domestic").show();
        $(".tooltip_for_Attraction").hide();
        $(".tooltip_for_International").hide();

        $(".instruction_for_Overseas").hide();
        $(".instruction_for_Domestic").show();
        $(".instruction_for_Attraction").hide();
        $(".instruction_for_International").hide();


        $(".text").show();

        setup_Domestic_dashboard();
        newViewState_Domestic();
        newController_Domestic();
        console.log(layerVisibility);
    }
    
    else if(document.getElementById("Attractionradio").checked) {
        layerVisibility = {Overseas:false, Domestic:false, Attraction:true, International:false};
        $(".dashboard_for_Overseas").hide();
        $(".dashboard_for_Domestic").hide();
        $(".dashboard_for_Attraction").show();
        $(".dashboard_for_International").hide();
    
        $(".tooltip_for_Overseas").hide();
        $(".tooltip_for_Domestic").hide();
        $(".tooltip_for_Attraction").show();
        $(".tooltip_for_International").hide();

        $(".instruction_for_Overseas").hide();
        $(".instruction_for_Domestic").hide();
        $(".instruction_for_Attraction").show();
        $(".instruction_for_International").hide();

        $(".text").hide();

        newViewState_Attraction();
        newController_Attraction();
        console.log(layerVisibility);
    }
    
    else if(document.getElementById("Internationalradio").checked) {
        layerVisibility = {Overseas:false, Domestic:false, Attraction:false, International:true};
        
        $(".dashboard_for_Overseas").hide();
        $(".dashboard_for_Domestic").hide();
        $(".dashboard_for_Attraction").hide(); 
        $(".dashboard_for_International").show();

        $(".tooltip_for_Overseas").hide();
        $(".tooltip_for_Domestic").hide();
        $(".tooltip_for_Attraction").hide();
        $(".tooltip_for_International").show(); 

        $(".instruction_for_Overseas").hide();
        $(".instruction_for_Domestic").hide();
        $(".instruction_for_Attraction").hide();
        $(".instruction_for_International").show();
        
        $(".text").hide();
        
        setup_International_dashboard();
        newViewState_International();
        newController_International();
        console.log(layerVisibility);
    }

    
    render(layerVisibility);
}


//////////////////////////////////
//                              //
// CHANGE LAYER FUNCTION        //
//                              //
//////////////////////////////////

// Render Layer Function
function render(layerVisibility) {

    const layers = [
    // Layer: Overseas Staying Visitors  
    new deck.GeoJsonLayer({
            id: 'Overseas',
            data: Daytime_Population,
            visible: layerVisibility.Overseas,
            // Styles
            filled: true,
            stroked: true,
            extruded: true,
            getFillColor: (f) => get_colour_Overseas(f.properties._Overseas_Staying_visitors),
            opacity: 0.9,
            getElevation: (f) => Math.sqrt(f.properties._Overseas_Staying_visitors) * 50,
            getLineColor: (f) => [255, 255, 255],
            
            pickable: true,
            autoHighlight: true,
            highlightColor: [85, 167, 208, 180],

            // Add onHover interaction
            onHover: ({ object }, info) => {
            (isHovering = Boolean(object));
            if (isHovering == true) {
                // console.log("onHover Function works!!");
                showTooltip_Overseas(info, object);
                }
                else { hideTooltip_Overseas(); }
            },
    }),


    // Layer: Domestic Staying Visitors
    new deck.GeoJsonLayer({
            id: 'Domestic',
            data: Daytime_Population,
            visible: layerVisibility.Domestic,

            filled: true,
            stroked: true,
            extruded: true,
            getFillColor: (f) => get_colour_Domestic(f.properties._Domestic_Staying_Visitors),
            opacity: 0.9,
            getElevation: (f) => Math.sqrt(f.properties._Domestic_Staying_Visitors) * 70,
            getLineColor: (f) => [255, 255, 255],
            
            pickable: true,
            autoHighlight: true,
            highlightColor: [85, 167, 208, 180],

            // Add onHover interaction
            onHover: ({ object }, info) => {
            (isHovering = Boolean(object));
            if (isHovering == true) {
                // console.log("onHover Function works!!");
                showTooltip_Domestic(info, object);
                }
                else { hideTooltip_Domestic(); }
            },

    }),


    // Layer: Attractions in London
    
    new deck.GeoJsonLayer({
            id: 'DaytimePopu',
            data: Daytime_Population,
            visible: layerVisibility.Attraction,
            // Styles
            filled: true,
            stroked: true,
            getFillColor: (f) => [255, 255, 255, 40],
            // getElevation: f => Math.sqrt(f.properties._Domestic_Staying_Visitors) * 50,
            getLineColor: (f) => [255, 255, 255, 220],
            lineWidthScale: 10,
    }),

    new deck.ScatterplotLayer({
            id: 'attraction',
            data: AttractionData,
            visible:layerVisibility.Attraction,

            opacity: 0.6,
            stroked: false,
            filled: true,
            radiusScale: 13, // size of point
            radiusMinPixels: 1,
            radiusMaxPixels: 8,
            lineWidthMinPixels: 0.5,
            getPosition: (d) => [d.geometry_coordinates_0, d.geometry_coordinates_1],
            getRadius: 15,
            getFillColor: (f) => get_colour_Attraction(f.properties_kinds_1),
            getLineColor: (d) => [255, 255, 255],
            zIndex: 100,
            
            pickable: true,
            autoHighlight: true,
            highlightColor: [85, 167, 208, 228],

            // Add onHover interaction
            onHover: ({ object }, info) => {
            (isHovering = Boolean(object));
            if (isHovering == true) {
                // console.log(object.properties[1].value);
                // console.log("onHover Function works!!");
                showTooltip(info, object);
                getSuggestion(info, object);
                }
                else { hideTooltip(); }
            },
    }),



    // Layer: The Origins of International Visitos to London
    new deck.ScatterplotLayer({
            id: 'point-layer',
            data: InternationalVisitorData,
            visible:layerVisibility.International,
            pickable: true,
            opacity: 0.2,
            stroked: true,
            filled: true,
            radiusScale: 100,
            radiusMinPixels: 1,
            radiusMaxPixels: 100,
            lineWidthMinPixels: 0.5,
            getPosition: d => d.From_coordinate,
            getRadius: d => Math.sqrt(d.LastYear) * 180,
            getFillColor: d => [143, 123, 224],
            getLineColor: d => [69, 64, 100]
    }),

    new deck.ArcLayer({
            id: 'InternationalVisitor',
            data: InternationalVisitorData,
            visible:layerVisibility.International,
            pickable: true,
            getWidth: 1.2,
            getSourcePosition: d => d.From_coordinate,
            getTargetPosition: d => d.To_coordinate,
            getSourceColor: [255, 255, 255],
            getTargetColor: [255, 255, 255],
            getSourceColor: d => [158, 1, 1],
            getTargetColor: d => [184, 109, 218],

            pickable: true,
            autoHighlight: true,
            highlightColor: [85, 167, 208, 228],

            // Add onHover interaction
            onHover: ({ object }, info) => {
            (isHovering = Boolean(object));
            if (isHovering == true) {
                // console.log("onHover Function works!!");
                showTooltip_International(info, object);
                }
                else { hideTooltip_International(); }
            },
    }),

    new deck.TextLayer({
            id: 'text-layer',
            data: InternationalVisitorData,
            visible:layerVisibility.International,
            getPosition: f => f.From_coordinate,
            getText: f => { return f.Country_of_origin.toString(); },
            getSize: 9,
            getColor: [255, 255, 255, 180],
            getAngle: 0,
            getTextAnchor: 'middle',
            getAlignmentBaseline: 'center',
            fontFamily: 'Gill Sans',
            // getbackgroundColor: [255, 255, 255,180]
    }),


  ];

  console.log(layerVisibility);
  deckgl.setProps({layers});
  
}




//////////////////////////
//                      //
//ATTRACTION SUGGESTION //
//                      //
//////////////////////////

// Layer: Attraction- Get suggestion function

function getSuggestion(info, object){
    if (object.properties_kinds_1 === "religion"){
        $('#suggest_attraction').html("<p id='suggest_text'>" + "- St. Paul's Cathedral" 
            + "</p>" + "<p id='suggest_text'>" + "- Crist Church" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Lumley Chapel" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Old St Andrew" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- St Peter's" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Tree Cathedral" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- The Space" + "</p>")
    }


    else if (object.properties_kinds_1 === "historic_architecture"){
        $('#suggest_attraction').html("<p id='suggest_text'>" + "- The Queen Adelaide" 
            + "</p>" + "<p id='suggest_text'>" + "- The Old Jail" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- King's Head" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Masons Arms" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Old Red Lion" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Rose & Crown" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Winchester Palace" + "</p>")
    }

    else if (object.properties_kinds_1 === "industrial_facilities"){
        $('#suggest_attraction').html("<p id='suggest_text'>" + "- Acton Town" 
            + "</p>" + "<p id='suggest_text'>" + "- Kew Gardens" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Tooting Bec" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Godalming" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Hertford East" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Colliers Wood" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Balham" + "</p>")
    }

    else if (object.properties_kinds_1 === "cultural"){
        $('#suggest_attraction').html("<p id='suggest_text'>" + "- Phoenix" 
            + "</p>" + "<p id='suggest_text'>" + "- Rio Cinema" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Victoria Palace Theatre" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Hoxton Hall" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- London Palladium" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Cambridge Theatre" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Apollo Theatre" + "</p>")
    }

    else if (object.properties_kinds_1 === "historic"){
        $('#suggest_attraction').html("<p id='suggest_text'>" + "- London Troops War Memorial" 
            + "</p>" + "<p id='suggest_text'>" + "- Queen Ann" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- War Memorial" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Lord Palmerston" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Earl of Derby" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- George Canning" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Jan Smut" + "</p>")
    }

    else if (object.properties_kinds_1 === "biographical_museums"){
        $('#suggest_attraction').html("<p id='suggest_text'>" + "- Ascott House" 
            + "</p>" + "<p id='suggest_text'>" + "- Bengamin Franklin House" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Fenton House" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Wesley's Chapel" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Lighton House Museum" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Milton's Cottage" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Dickens Museum" + "</p>")
    }

    else if (object.properties_kinds_1 === "museums"){
        $('#suggest_attraction').html("<p id='suggest_text'>" + "- Tate Museum" 
            + "</p>" + "<p id='suggest_text'>" + "- British Museum" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Two Temple Place" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Museum of London Docklands" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Orleans House Gallery" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Royal Academy" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- The Fine Art Society" + "</p>")
    }

    else if (object.properties_kinds_1 === "gardens_and_parks"){
        $('#suggest_attraction').html("<p id='suggest_text'>" + "- Hyde Park" 
            + "</p>" + "<p id='suggest_text'>" + "- Happy Valley" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Regent Park" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Bloomsbury Square" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Syon Park" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Walpole Park" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Horniman Museum and Garden" + "</p>")
    }

    else {
        $('#suggest_attraction').html("<p id='suggest_text'>" + "- The Bedford" 
            + "</p>" + "<p id='suggest_text'>" + "- Gomm Valley" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Regent Park" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Dancersend" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Rye Mead" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- Shakespeare Fountain" + "</p>"
            + "</p>" + "<p id='suggest_text'>" + "- The Cross Keys" + "</p>")
    }
};

</script>
</html>